# See https://github.com/syssi/esphome-jk-bms/issues/758
#
# JK-B2A25S-RP with 25 cells

<<: !include esp32-ble-b2a25s-example.yaml

interval:
  - interval: 30s
    then:
      # Vendor ID: JK_B2A25SRP
      # Hardware version: 11A
      # Software version: 11.55
      # Uptime: 619502 s
      # Power on count: 9
      # Device name: BMS_8
      # Device passcode: 1234
      # Manufacturing date: 250614
      # Serial number: 41018301681
      # Passcode:
      # User data: Input Userdata
      # Setup passcode: 123456
      # UART1 Protocol: 0
      # CAN Protocol: 0
      # UART2 Protocol: 0
      # RCV Time: 0.0 h
      # RFV Time: 0.0 h
      - lambda: |-
          const uint8_t device_info_frame[300] = {
            0x55, 0xAA, 0xEB, 0x90, 0x03, 0x00, 0x4A, 0x4B, 0x5F, 0x42, 0x32, 0x41, 0x32, 0x35, 0x53, 0x52, 0x50, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x31, 0x31, 0x41, 0x00, 0x00, 0x00, 0x00, 0x00, 0x31, 0x31, 0x2E, 0x35, 0x35, 0x00,
            0x00, 0x00, 0xEE, 0x73, 0x09, 0x00, 0x09, 0x00, 0x00, 0x00, 0x42, 0x4D, 0x53, 0x5F, 0x38, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x31, 0x32, 0x33, 0x34, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x32, 0x35, 0x30, 0x36, 0x31, 0x34, 0x00, 0x00, 0x34, 0x31, 0x30, 0x31,
            0x38, 0x33, 0x30, 0x31, 0x36, 0x38, 0x31, 0x00, 0x30, 0x30, 0x30, 0x00, 0x49, 0x6E, 0x70, 0x75, 0x74, 0x20,
            0x55, 0x73, 0x65, 0x72, 0x64, 0x61, 0x74, 0x61, 0x00, 0x00, 0x31, 0x32, 0x33, 0x34, 0x35, 0x36, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFE, 0xF9, 0xFF, 0xFF, 0xFF, 0x2D, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00,
            0x90, 0x1F, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xD8, 0xE7, 0x32, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x24, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x41, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x09, 0x00, 0x00, 0x00, 0x64, 0x00, 0x00, 0x00, 0x5F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFE,
            0x9F, 0x21, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xE6
          };
          id(bms0).assemble(device_info_frame, sizeof(device_info_frame));
      - delay: 6s

      #  Smart sleep voltage: 3.500000
      # Cell UVP: 2.600000 V
      # Cell UVPR: 2.650000 V
      # Cell OVP: 3.600000 V
      # Cell OVPR: 3.550000 V
      # Balance trigger voltage: 0.005000 V
      # SOC 100% voltage: 3.560000 V
      # SOC 0% voltage: 2.620000 V
      # Voltage cell request charge voltage [RCV]: 0.000000 V
      # Voltage cell request float voltage [RFV]: 0.000000 V
      # Power off voltage: 2.500000 V
      # Max. charge current: 25.000002 A
      # Charge OCP delay: 30.000000 s
      # Charge OCP recovery time: 60.000000 s
      # Max. discharge current: 1000.000061 A
      # Discharge OCP delay: 300.000000 s
      # Discharge OCP recovery time: 60.000000 s
      # Short circuit protection recovery time: 5.000000 s
      # Max. balance current: 2.000000 A
      # Charge OTP: 70.000000 °C
      # Charge OTP recovery: 60.000000 °C
      # Discharge OTP: 70.000000 °C
      # Discharge OTP recovery: 60.000000 °C
      # Charge UTP: -20.000000 °C
      # Charge UTP recovery: -10.000000 °C
      # Mosfet OTP: 100.000000 °C
      # Mosfet OTP recovery: 80.000000 °C
      # Cell count: 25.000000
      # Charge switch: OFF
      # Discharge switch: OFF
      # Balancer switch: ON
      # Nominal battery capacity: 330.000031 Ah
      # Short circuit protection delay: 0.000000 us
      # Start balance voltage: 3.000000 V
      # Con. wire resistance 1: 0.000000 Ohm
      # Con. wire resistance 2: 0.000000 Ohm
      # Con. wire resistance 3: 0.000000 Ohm
      # Con. wire resistance 4: 0.000000 Ohm
      # Con. wire resistance 5: 0.000000 Ohm
      # Con. wire resistance 6: 0.000000 Ohm
      # Con. wire resistance 7: 0.000000 Ohm
      # Con. wire resistance 8: 0.000000 Ohm
      # Con. wire resistance 9: 0.000000 Ohm
      # Con. wire resistance 10: 0.000000 Ohm
      # Con. wire resistance 11: 0.000000 Ohm
      # Con. wire resistance 12: 0.000000 Ohm
      # Con. wire resistance 13: 0.000000 Ohm
      # Con. wire resistance 14: 0.000000 Ohm
      # Con. wire resistance 15: 0.000000 Ohm
      # Con. wire resistance 16: 0.000000 Ohm
      # Con. wire resistance 17: 0.000000 Ohm
      # Con. wire resistance 18: 0.000000 Ohm
      # Con. wire resistance 19: 0.000000 Ohm
      # Con. wire resistance 20: 0.000000 Ohm
      # Con. wire resistance 21: 0.000000 Ohm
      # Con. wire resistance 22: 0.000000 Ohm
      # Con. wire resistance 23: 0.000000 Ohm
      # Con. wire resistance 24: 0.000000 Ohm
      # Con. wire resistance 25: 0.000000 Ohm
      # Con. wire resistance 26: 0.000000 Ohm
      # Con. wire resistance 27: 0.000000 Ohm
      # Con. wire resistance 28: 0.000000 Ohm
      # Con. wire resistance 29: 0.000000 Ohm
      # Con. wire resistance 30: 0.000000 Ohm
      # Con. wire resistance 31: 0.000000 Ohm
      # Con. wire resistance 32: 0.000000 Ohm
      # Device address: 1
      # Precharge time: 5 s
      # Heating switch: OFF
      # GPS Heartbeat: OFF
      # Port switch: CAN
      # Special charger: OFF
      # Smart sleep: 24 h
      # Data field enable control 0: 254
      - lambda: |-
          const uint8_t settings_frame[300] = {
            0x55, 0xAA, 0xEB, 0x90, 0x01, 0x9E, 0xAC, 0x0D, 0x00, 0x00, 0x28, 0x0A, 0x00, 0x00, 0x5A, 0x0A, 0x00, 0x00,
            0x10, 0x0E, 0x00, 0x00, 0xDE, 0x0D, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0xE8, 0x0D, 0x00, 0x00, 0x3C, 0x0A,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC4, 0x09, 0x00, 0x00, 0xA8, 0x61, 0x00, 0x00,
            0x1E, 0x00, 0x00, 0x00, 0x3C, 0x00, 0x00, 0x00, 0x40, 0x42, 0x0F, 0x00, 0x2C, 0x01, 0x00, 0x00, 0x3C, 0x00,
            0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0xD0, 0x07, 0x00, 0x00, 0xBC, 0x02, 0x00, 0x00, 0x58, 0x02, 0x00, 0x00,
            0xBC, 0x02, 0x00, 0x00, 0x58, 0x02, 0x00, 0x00, 0x38, 0xFF, 0xFF, 0xFF, 0x9C, 0xFF, 0xFF, 0xFF, 0xE8, 0x03,
            0x00, 0x00, 0x20, 0x03, 0x00, 0x00, 0x19, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x01, 0x00, 0x00, 0x00, 0x10, 0x09, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0xB8, 0x0B, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x01, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x20, 0xA1, 0x07, 0x00, 0x00, 0x00, 0x3C, 0x32, 0x18, 0xFE,
            0xF9, 0xFF, 0xFF, 0xFF, 0x29, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x31

          };
          id(bms0).assemble(settings_frame, sizeof(settings_frame));
      - delay: 6s

      - lambda: |-
          const uint8_t cell_info_frame[300] = {
            0x55, 0xAA, 0xEB, 0x90, 0x02, 0x95, 0x3D, 0x0E, 0x3C, 0x0E, 0x3A, 0x0E, 0x3B, 0x0E, 0x3A, 0x0E, 0x3C, 0x0E,
            0x3D, 0x0E, 0x3D, 0x0E, 0x3B, 0x0E, 0x3D, 0x0E, 0x3D, 0x0E, 0x3A, 0x0E, 0x3B, 0x0E, 0x3D, 0x0E, 0x3A, 0x0E,
            0x3C, 0x0E, 0x3A, 0x0E, 0x3C, 0x0E, 0x3B, 0x0E, 0x3D, 0x0E, 0x3D, 0x0E, 0x3D, 0x0E, 0x3D, 0x0E, 0x3D, 0x0E,
            0x3A, 0x0E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF,
            0xFF, 0x01, 0x3C, 0x0E, 0x03, 0x00, 0x00, 0x02, 0x43, 0x00, 0x40, 0x00, 0x3F, 0x00, 0x3D, 0x00, 0x3A, 0x00,
            0x38, 0x00, 0x36, 0x00, 0x34, 0x00, 0x32, 0x00, 0x30, 0x00, 0x2F, 0x00, 0x2D, 0x00, 0x2D, 0x00, 0x2F, 0x00,
            0x30, 0x00, 0x32, 0x00, 0x33, 0x00, 0x35, 0x00, 0x38, 0x00, 0x39, 0x00, 0x3B, 0x00, 0x3E, 0x00, 0x40, 0x00,
            0x41, 0x00, 0x43, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x30, 0xF8, 0x00, 0x00, 0x00, 0x00, 0xDA, 0x63, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x30, 0xF8, 0x30, 0xF8, 0x10, 0x00, 0x09, 0x00, 0x00, 0x00, 0x00, 0x63, 0x70, 0x02, 0x05, 0x00, 0x10, 0x09,
            0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF7, 0x06, 0x00, 0x00, 0x64, 0x00, 0x00, 0x00, 0x23, 0x7D, 0x03, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF0, 0x00,
            0x01, 0x00, 0x00, 0x00, 0xF1, 0x03, 0x00, 0x00, 0x00, 0x00, 0xA8, 0x0A, 0x40, 0x40, 0x00, 0x00, 0x00, 0x00,
            0x95, 0x23, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x06, 0x00, 0x00, 0xF1, 0x5F, 0x1E, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x30, 0xF8, 0x00, 0x00, 0x00, 0x00, 0xE8, 0x03, 0xC3, 0x11, 0x4F, 0x0A, 0x45, 0x00, 0x00, 0x00,
            0x80, 0x51, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFE,
            0xFE, 0x7F, 0xDD, 0x2F, 0x01, 0x05, 0x89, 0x03, 0x00, 0x00, 0x00, 0x7F
          };
          id(bms0).assemble(cell_info_frame, sizeof(cell_info_frame));
      - delay: 6s

      - lambda: |-
          const uint8_t cell_info_frame[300] = {
            0x55, 0xAA, 0xEB, 0x90, 0x02, 0xE2, 0x39, 0x0E, 0x38, 0x0E, 0x37, 0x0E, 0x37, 0x0E, 0x39, 0x0E, 0x39, 0x0E,
            0x39, 0x0E, 0x38, 0x0E, 0x39, 0x0E, 0x39, 0x0E, 0x39, 0x0E, 0x39, 0x0E, 0x39, 0x0E, 0x39, 0x0E, 0x39, 0x0E,
            0x39, 0x0E, 0x39, 0x0E, 0x36, 0x0E, 0x39, 0x0E, 0x39, 0x0E, 0x37, 0x0E, 0x38, 0x0E, 0x36, 0x0E, 0x36, 0x0E,
            0x39, 0x0E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF,
            0xFF, 0x01, 0x39, 0x0E, 0x03, 0x00, 0x00, 0x11, 0x41, 0x00, 0x3F, 0x00, 0x3D, 0x00, 0x3C, 0x00, 0x3E, 0x00,
            0x39, 0x00, 0x35, 0x00, 0x34, 0x00, 0x33, 0x00, 0x31, 0x00, 0x2F, 0x00, 0x2E, 0x00, 0x2F, 0x00, 0x32, 0x00,
            0x33, 0x00, 0x36, 0x00, 0x37, 0x00, 0x39, 0x00, 0x3A, 0x00, 0x3C, 0x00, 0x3F, 0x00, 0x42, 0x00, 0x43, 0x00,
            0x46, 0x00, 0x47, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x30, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x85, 0x63, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x30, 0xF8, 0x30, 0xF8, 0x10, 0x00, 0x09, 0x00, 0x00, 0x00, 0x00, 0x64, 0x84, 0x08, 0x05, 0x00, 0x10, 0x09,
            0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x00, 0x00, 0x64, 0x00, 0x00, 0x00, 0xBC, 0x5E, 0x09, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF0, 0x00,
            0x01, 0x00, 0x00, 0x00, 0xEE, 0x03, 0x00, 0x00, 0x00, 0x00, 0x34, 0x27, 0x40, 0x40, 0x00, 0x00, 0x00, 0x00,
            0x8D, 0x23, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x06, 0x00, 0x00, 0x82, 0x6B, 0x1E, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x30, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x04, 0xC9, 0x11, 0x4F, 0x0A, 0x60, 0x00, 0x00, 0x00,
            0x80, 0x51, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFE,
            0xFE, 0x7F, 0xDD, 0x2F, 0x01, 0x05, 0x89, 0x03, 0x00, 0x00, 0x00, 0x7D
          };
          id(bms0).assemble(cell_info_frame, sizeof(cell_info_frame));
      - delay: 6s

      - lambda: |-
          const uint8_t cell_info_frame[300] = {
            0x55, 0xAA, 0xEB, 0x90, 0x02, 0x9F, 0x3D, 0x0E, 0x3C, 0x0E, 0x3A, 0x0E, 0x3B, 0x0E, 0x3A, 0x0E, 0x3D, 0x0E,
            0x3D, 0x0E, 0x3D, 0x0E, 0x3C, 0x0E, 0x3D, 0x0E, 0x3D, 0x0E, 0x3A, 0x0E, 0x3B, 0x0E, 0x3D, 0x0E, 0x3A, 0x0E,
            0x3C, 0x0E, 0x3A, 0x0E, 0x3C, 0x0E, 0x3B, 0x0E, 0x3D, 0x0E, 0x3D, 0x0E, 0x3D, 0x0E, 0x3D, 0x0E, 0x3D, 0x0E,
            0x3A, 0x0E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF,
            0xFF, 0x01, 0x3C, 0x0E, 0x03, 0x00, 0x00, 0x02, 0x43, 0x00, 0x40, 0x00, 0x3F, 0x00, 0x3D, 0x00, 0x3A, 0x00,
            0x38, 0x00, 0x36, 0x00, 0x34, 0x00, 0x32, 0x00, 0x30, 0x00, 0x2F, 0x00, 0x2D, 0x00, 0x2D, 0x00, 0x2F, 0x00,
            0x30, 0x00, 0x32, 0x00, 0x33, 0x00, 0x35, 0x00, 0x38, 0x00, 0x39, 0x00, 0x3B, 0x00, 0x3E, 0x00, 0x40, 0x00,
            0x41, 0x00, 0x43, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x30, 0xF8, 0x00, 0x00, 0x00, 0x00, 0xDB, 0x63, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x30, 0xF8, 0x30, 0xF8, 0x10, 0x00, 0x09, 0x00, 0x00, 0x00, 0x00, 0x63, 0x70, 0x02, 0x05, 0x00, 0x10, 0x09,
            0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF7, 0x06, 0x00, 0x00, 0x64, 0x00, 0x00, 0x00, 0x28, 0x7D, 0x03, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF0, 0x00,
            0x01, 0x00, 0x00, 0x00, 0xF1, 0x03, 0x00, 0x00, 0x00, 0x00, 0xA8, 0x0A, 0x40, 0x40, 0x00, 0x00, 0x00, 0x00,
            0x95, 0x23, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x06, 0x00, 0x00, 0x28, 0x60, 0x1E, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x30, 0xF8, 0x00, 0x00, 0x00, 0x00, 0xE8, 0x03, 0xC8, 0x11, 0x4F, 0x0A, 0x45, 0x00, 0x00, 0x00,
            0x80, 0x51, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFE,
            0xFE, 0x7F, 0xDD, 0x2F, 0x01, 0x05, 0x89, 0x03, 0x00, 0x00, 0x00, 0xCE
          };
          id(bms0).assemble(cell_info_frame, sizeof(cell_info_frame));
